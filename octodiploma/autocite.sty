  \ProvidesPackage{autocite}[2006/12/07 \space  v 1.3]

% определение названия
\if@russify
    \newcommand\authorbibname{Список публикаций автора}
\else
    \newcommand\authorbibname{Authors Works}
\fi

% новое окружение, аналогичное "thebibliography"
% перед каждой записью добавляется "A"
\newenvironment{autobibliography}[1]
     {\freesection{\authorbibname}%
      \@mkboth{\MakeUppercase\authorbibname}{\MakeUppercase\authorbibname}%
      \list{\@biblabel{A\@arabic\c@enumiv}}%
           {\settowidth\labelwidth{A\@biblabel{#1}}%
            \leftmargin\labelwidth
            \advance\leftmargin\labelsep
            \@openbib@code
            \usecounter{enumiv}%
            \let\p@enumiv\@empty
            \renewcommand\theenumiv{\@arabic\c@enumiv}}%
      \sloppy
      \clubpenalty4000
      \@clubpenalty \clubpenalty
      \widowpenalty4000%
      \sfcode`\.\@m}
     {\def\@noitemerr
       {\@latex@warning{Empty `autobibliography' environment}}%
      \endlist}
% новая команда пункта библиографии, аналогичная "bibitem"
% отличие заключается в том, что нумерация становится отрицательной
\def\autobibitem{\@ifnextchar[\@lautobibitem\@autobibitem}
\def\@lautobibitem[#1]#2{\item[\@biblabel{#1}\hfill]\if@filesw
      {\let\protect\noexpand
       \immediate
       \write\@auxout{\string\bibcite{#2}{#1}}}\fi\ignorespaces}
\def\@autobibitem#1{\item\if@filesw \immediate\write\@auxout
       {\string\bibcite{#1}{-\the\value{\@listctr}}}\fi\ignorespaces}

% первый аргумент - счетчик
% второй аргумент - строковая переменная
% команда присваивает счетчику значение, противоположное значению переменной
\def\@chgsign#1#2{%
\ifnum \value{#1}>#2%
    \addtocounter{#1}{-1}%
    \@chgsign{#1}#2%
\fi%
\ifnum \value{#1}<#2%
    \addtocounter{#1}{1}%
    \@chgsign{#1}#2%
\fi%
\ifnum \value{#1}=#2%
    \setcounter{#1}{-\value{#1}}%
\fi}

% модификация команды пакета "cite"
% обрабатывает как положительные, так и отрицательные номера
\def\@make@cite@list{%
 \expandafter\let \expandafter\@B@citeB
          \csname b@\@citeb\@extra@b@citeb \endcsname
 \ifx\@B@citeB\relax %
    \@citea {\bfseries ?}\let\@citea\citepunct \G@refundefinedtrue
    \@warning {Citation `\@citeb' on page \thepage\space undefined}%
    \oc@verbo \global\@namedef{b@\@citeb\@extra@b@citeb}{?}%
 \else %
 % проверка  формата:
    \ifcat _\ifnum\z@<0\@B@citeB _\else A\fi % положительное число:
        \@addto@cite@list% обычная обработка
        \@autobcfalse%
    \else %
        \ifcat _\ifnum\z@>\@B@citeB _\else A\fi %отрицательное число: модифицированная обработка
            \@chgsign{tmpbcounter}\@B@citeB%
            \@addto@cite@list@inv%
            \@autobctrue%
        \else % не число печатается сразу
            \@citea \citeform{\@B@citeB}\let\@citea\citepunct
        \fi
 \fi\fi}

% счетчик для смены знака отрицательных номеров
\newcounter{tmpbcounter}
\setcounter{tmpbcounter}{0}

% модификация команды пакета "cite"
% специально для отрицательных номеров
\def\@addto@cite@list@inv{\@tempcnta\the\value{tmpbcounter}\relax%
   \ifnum \@tempcnta>\@tempcntb %
      \edef\@cite@list{\@cite@list\@celt{\the\value{tmpbcounter}}}%
      \@tempcntb\@tempcnta%
   \else %
      \edef\@cite@list{\expandafter\@sort@celt\@cite@list \@gobble @}%
   \fi}

% флаг нормальной или auto-ссылки
\newif\if@autobc \@autobcfalse

% добавляет "A" перед каждой ссылкой в соответствии с
\renewcommand\citeform[1]{%
    \if@autobc%
        A#1%
    \else%
        #1%
    \fi}

% позволяет в одной ссылке цитировать нормальные и авторские ссылки
\def\citeboth#1#2{\@citess{\citen{#1}\citepunct\citen{#2}}}

